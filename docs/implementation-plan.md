# 実装計画

## MVP機能の優先順位

ヒアリング結果を元に、GraphVerseの最小実行可能プロダクト（MVP）の実装計画を策定します。

## フェーズ1: コア機能 (4-5週間)

### Week 1: 基盤構築
**目標**: 基本的な画面表示とデータフロー

**実装項目**:
1. **基本レイアウト**
   - `src/app/page.tsx`: グリッドレイアウト（GraphView + BranchView）
   - ヘッダーコンポーネント（セッション名表示）
   - レスポンシブ対応

2. **GraphView (基本版)**
   - React Flowの設定・統合
   - ノード表示（ChatCard基本デザイン）
   - エッジ表示
   - ズーム・パン操作

3. **Zustand Store**
   - 既存コードの更新（新しい型定義に合わせる）
   - セッション管理の基本機能
   - ノード・エッジ操作の基本機能

**成果物**: 
- 基本的なグラフが表示される
- サンプルデータで動作確認

### Week 2: 単一ブランチ機能
**目標**: 最も重要な「単一ブランチからの派生」機能

**実装項目**:
1. **BranchView**
   - 選択されたノードの表示
   - チャット履歴の時系列表示
   - 基本的な入力フォーム

2. **コンテキスト選択**
   - GraphViewでのノードクリック → BranchViewへの反映
   - 単一ノード選択の実装

3. **Chat API (基本版)**
   - `src/app/api/chat/route.ts`
   - Google Generative AI連携
   - 基本的なストリーミング応答

**成果物**:
- ノードをクリックしてコンテキスト選択可能
- 新しいメッセージ送信で新ノード生成

### Week 3: コンテキスト管理機能
**目標**: 複数コンテキスト選択とトークン制限管理

**実装項目**:
1. **複数コンテキスト選択**
   - ContextManagerコンポーネント
   - 複数ノードの同時選択UI
   - 選択状態の可視化

2. **トークン制限管理**
   - トークン数計算（概算）
   - 制限表示とアラート
   - 動的な選択可否判定

3. **Chat API (拡張版)**
   - 複数コンテキストの処理
   - branchType判定
   - エッジ自動生成

**成果物**:
- 複数ノードをコンテキストに選択可能
- トークン制限が正しく表示・管理される

### Week 4: セッション管理
**目標**: 基本的なセッション管理機能

**実装項目**:
1. **セッション一覧**
   - セッション履歴の表示
   - セッション切り替え機能
   - 新規セッション作成

2. **データ永続化**
   - LocalStorageを使用した基本的な保存
   - セッションデータの読み込み・保存

3. **Session API**
   - `src/app/api/sessions/route.ts`
   - セッション作成・取得・更新API

**成果物**:
- セッションを作成・切り替え可能
- データが永続化される

### Week 5: テスト・デバッグ・改善
**目標**: フェーズ1機能の品質向上

**実装項目**:
1. **エラーハンドリング**
   - API エラー時の適切な表示
   - ネットワークエラー対応
   - ユーザーフィードバック

2. **パフォーマンス最適化**
   - React Flowの最適化
   - 大きなグラフの表示改善
   - メモリ管理

3. **ユーザビリティ改善**
   - ローディング状態の表示
   - トランジション・アニメーション
   - キーボードショートカット

**成果物**:
- 安定した基本機能
- 良好なユーザー体験

## フェーズ2: 拡張機能 (3-4週間)

### Week 6-7: Merge機能
**目標**: グラフ構造での会話merge機能

**実装項目**:
1. **MergePanel コンポーネント**
   - Mergeモード専用UI
   - 複数ノード選択管理
   - Mergeプロンプト入力

2. **GraphView (Merge対応)**
   - Mergeモード時の表示切り替え
   - 複数選択UI（チェックボックス）
   - 選択状態の可視化

3. **Merge API**
   - 複数コンテキストからの新ノード生成
   - 複数エッジの自動生成
   - branchType: 'merge' 対応

**成果物**:
- 複数ノードを選択してmerge可能
- Merge結果が適切にグラフに反映

### Week 8: 新トピック機能
**目標**: 独立した新しい話題の開始

**実装項目**:
1. **新トピック UI**
   - 「新トピック」ボタン
   - コンテキストクリア機能
   - 独立ノード作成

2. **グラフ表示の改善**
   - 複数の独立部分グラフ表示
   - ノードのグループ化表示
   - レイアウト自動調整

**成果物**:
- コンテキストなしで新しい話題を開始可能
- 複数の独立した対話グループを管理可能

### Week 9: テスト・リファクタリング
**目標**: フェーズ2機能の安定化

## フェーズ3: 将来機能 (長期)

### 検索機能
- ノード内容の全文検索
- トピック別フィルタリング
- 関連ノード推奨

### 表示最適化
- グラフの階層化表示
- フィルター・ソート機能
- パフォーマンス改善

### エクスポート機能
- グラフ画像出力
- Markdown形式出力
- 構造化データ出力

## 技術的検討事項

### データ永続化戦略
**フェーズ1**: LocalStorage（プロトタイプ用）
**フェーズ2**: SQLite/Dexie.js（クライアントサイド）
**将来**: PostgreSQL + Prisma（サーバーサイド）

### AI API選択
**現在**: Google Generative AI
**将来検討**: OpenAI GPT-4, Claude, 複数モデル対応

### パフォーマンス目標
- 100ノード以下: スムーズな操作
- 500ノード: 実用的な速度
- 1000ノード以上: 階層化・仮想化で対応

## リスク管理

### 高リスク項目
1. **React Flowの複雑化**: ノード数増加時のパフォーマンス
2. **コンテキスト管理**: LLMの制限への対応
3. **UI/UX**: 複雑な操作の直感性

### 対策
1. **段階的実装**: 小さく始めて徐々に拡張
2. **プロトタイプ検証**: 早期のユーザーテスト
3. **代替案準備**: 技術選択の柔軟性確保

## 成功指標

### フェーズ1
- [ ] 基本的なグラフ操作が可能
- [ ] 単一ブランチからの派生が動作
- [ ] コンテキスト選択・管理が動作
- [ ] セッション管理が動作

### フェーズ2
- [ ] Merge機能が動作
- [ ] 新トピック機能が動作
- [ ] 複数の独立グラフを管理可能

### 品質指標
- [ ] レスポンス時間: < 2秒（100ノード）
- [ ] エラー率: < 1%
- [ ] ユーザビリティテスト: 満足度 > 4/5